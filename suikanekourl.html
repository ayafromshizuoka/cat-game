<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>猫シンカ - Cat Evolution</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <style>
        body { margin: 0; overflow: hidden; background: #fdf5e6; font-family: sans-serif; }
        canvas { display: block; margin: 0 auto; background: #fff; box-shadow: 0 0 20px rgba(0,0,0,0.1); }
        #score { position: absolute; top: 20px; left: 20px; font-size: 24px; color: #8b4513; font-weight: bold; }
    </style>
</head>
<body>
    <div id="score">Score: 0</div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <script>
        const { Engine, Render, Runner, World, Bodies, Body, Events, Composite } = Matter;

        // --- 設定 ---
        const WIDTH = 400;
        const HEIGHT = 600;
        const IMG_BASE_URL ="./";
        const CAT_DATA = [
            { radius: 10, score: 2 },   // cat1.png
            { radius: 15, score: 4 },   // cat2.png
            { radius: 20, score: 8 },   // cat3.png
            { radius: 25, score: 16 },  // cat4.png
            { radius: 30, score: 32 },  // cat5.png
            { radius: 35, score: 64 },  // cat6.png
            { radius: 40, score: 128 }, // cat7.png
            { radius: 45, score: 256 }, // cat8.png
            { radius: 50, score: 512 },// cat9.png
            { radius: 55, score: 1024 },// cat10.png
            { radius: 65, score: 2048 } // cat11.png
        ];

        // --- 初期化 ---
        const engine = Engine.create();
        const render = Render.create({
            element: document.body,
            engine: engine,
            options: { width: WIDTH, height: HEIGHT, wireframes: false, background: '#fff' }
        });
        const runner = Runner.create();
        Render.run(render);
        Runner.run(runner, engine);

        // 壁の作成

        // ゲームオーバーの点線（高さ150pxの位置）
       const lineY = 150;

       // 毎フレームの更新処理
       Events.on(engine, 'afterUpdate', () => {
       let isGameOver = false;
    
       // 画面内のすべての物体をチェック
       Composite.allBodies(engine.world).forEach(body => {
        // 猫（静止していないもの）がラインを超えているか
        if (body.label.startsWith("cat_") && !body.isStatic && body.position.y < lineY) {
            // 3秒間超え続けたらゲームオーバーにするためのカウント（簡易版）
            isGameOver = true;
        }
    });

    // 背景に点線を描画（Renderの後に処理を追加する代わりに、簡易的にラインを表示）
    // ※今回は視覚的にわかりやすくするため、HTML要素としてラインを追加する修正をお勧めします。
});
        const ground = Bodies.rectangle(WIDTH/2, HEIGHT + 25, WIDTH, 50, { isStatic: true, render: { fillStyle: '#deb887' } });
        const leftWall = Bodies.rectangle(-25, HEIGHT/2, 50, HEIGHT, { isStatic: true });
        const rightWall = Bodies.rectangle(WIDTH + 25, HEIGHT/2, 50, HEIGHT, { isStatic: true });
        World.add(engine.world, [ground, leftWall, rightWall]);

        let score = 0;
        let currentLevel = 0;
        let isClickable = true;

        // 猫を作成する関数
        function createCat(x, y, level, isStatic = false) {
            const data = CAT_DATA[level];
            const cat = Bodies.circle(x, y, data.radius, {
                restitution: 0.4,
                isStatic: isStatic,
                label: "cat_" + level,
                render: {
                    sprite: {
                        // 本番環境ではココを実際の画像パスにします
                        texture: `${IMG_BASE_URL}cat${level + 1}.png`,
                        xScale: (data.radius * 2) / 100, // 画像サイズに合わせて調整
                        yScale: (data.radius * 2) / 100
                    }
                }
            });
            cat.level = level;
            return cat;
        }

        // クリックで猫を落とす
        window.addEventListener("mousedown", (e) => {
            if (!isClickable) return;
            isClickable = false;

            const rect = render.canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            
            const newCat = createCat(x, 50, currentLevel);
            World.add(engine.world, newCat);

            // 次の猫をランダムに準備 (Lv1〜3)
            setTimeout(() => {
                currentLevel = Math.floor(Math.random() * 3);
                isClickable = true;
            }, 1000);
        });

        // --- 進化のロジック ---
        Events.on(engine, 'collisionStart', (event) => {
            event.pairs.forEach((pair) => {
                const bodyA = pair.bodyA;
                const bodyB = pair.bodyB;

                if (bodyA.label.startsWith("cat_") && bodyA.label === bodyB.label) {
                    const level = bodyA.level;
                    if (level < CAT_DATA.length - 1) {
                        // 合体場所を計算
                        const newX = (bodyA.position.x + bodyB.position.x) / 2;
                        const newY = (bodyA.position.y + bodyB.position.y) / 2;

                        // 古い2匹を消去
                        World.remove(engine.world, [bodyA, bodyB]);

                        // 新しいレベルの猫を作成
                        const nextCat = createCat(newX, newY, level + 1);
                        World.add(engine.world, nextCat);

                        // スコア更新
                        score += CAT_DATA[level + 1].score;
                        document.getElementById("score").innerText = `Score: ${score}`;
                    }
                }
            });
        });
    </script>
</body>

</html><




